<div th:fragment="codeFragment(code)">
    <link rel="stylesheet" href="/css/style.css"/>
    <link rel="stylesheet" href="/css/codes/code.css" />
    <link rel="stylesheet" href="/prism/prism.css">

    <div>
        <h2 class ="title" th:text="${code.title()}"></h2>
        <div class ="author">
            <p>from: </p>
            <a th:href="'/users/' + ${code.userInformation().username()}" th:text="${code.userInformation().username()}"></a>
        </div>
    </div>
    <div class ="post code-container">
        <div class ="votes">
            <form name="vote" id="vote" th:data-code-id="${code.id()}">
                <button class="vote-btn upvote-btn" type="button" name="voteType" value="UpVote">▲</button>
                <p class="vote-score" th:text="${code.scoreVote()}"></p>
                <button class="vote-btn downvote-btn" type="button" name="voteType" value="DownVote">▼</button>
            </form>
        </div>
        <div class ="content">
            <p class="description" th:text="${code.description()}"></p>
            <a th:href="'/codes/' + ${code.id()}">
                <pre><code class="language-java java-code" th:data-code="${code.javaContent()}"></code></pre>
            </a>
            <pre th:if="${code.unitContent() != null}"><code class="language-java" th:text="${code.unitContent()}"></code></pre>
            <p class="date right" th:text="${code.date()}"></p>
        </div>
    </div>
    <script src="/prism/prism.js"></script>
    <script>
        /*
        document.querySelectorAll('.code-container').forEach(codeContainer => {
            const codeElement = codeContainer.querySelector('.language-java');
            const codeContent = codeElement.getAttribute('data-code');
            codeElement.textContent = codeContent;
        });
        */
        const codeElement = document.querySelector('.language-java')
        const codeContent = codeElement.getAttribute('data-code');
        codeElement.textContent = codeContent;

        document.querySelectorAll('.vote-btn').forEach(button => {
            button.addEventListener('click', function() {
                const form = this.closest('form');
                const codeId = form.getAttribute('data-code-id');
                const voteType = this.value;
                fetch('../api/v1/codes/vote/' + codeId + '?voteType=' + voteType, {
                    method: 'POST'
                })
                    .then(response => response.json())
                    .then(data => {
                        const scoreElement = form.querySelector('.vote-score');
                        scoreElement.textContent = data;
                    })
                    .catch(error => console.error('Error:', error));
            });
        });

    </script>

</div>